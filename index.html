<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AnnotateHQ Â· Project Manager</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg: #f0f4f9;
  --surface: #ffffff;
  --surface2: #f7fafd;
  --border: #dde5f0;
  --text: #0d1f33;
  --text2: #4a6080;
  --text3: #8098b4;
  --accent: #2563eb;
  --accent2: #3b82f6;
  --accent-light: #eff4ff;
  --green: #16a34a;
  --green-light: #dcfce7;
  --yellow: #d97706;
  --yellow-light: #fef3c7;
  --red: #dc2626;
  --red-light: #fee2e2;
  --purple: #7c3aed;
  --purple-light: #ede9fe;
  --shadow: 0 4px 20px rgba(13,31,51,0.07);
  --shadow-sm: 0 2px 8px rgba(13,31,51,0.05);
  --radius: 16px;
  --radius-sm: 10px;
  --radius-pill: 100px;
}
[data-theme="dark"] {
  --bg: #0d1117;
  --surface: #161b22;
  --surface2: #21262d;
  --border: #30363d;
  --text: #e6edf3;
  --text2: #8b949e;
  --text3: #484f58;
  --accent: #58a6ff;
  --accent2: #79c0ff;
  --accent-light: #1f2b3e;
  --green-light: #0d2a1a;
  --yellow-light: #2a1f0d;
  --red-light: #2a0d0d;
  --purple-light: #1e1430;
  --shadow: 0 4px 20px rgba(0,0,0,0.3);
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.2);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
  transition: background 0.3s, color 0.3s;
}
h1,h2,h3 { font-family: 'Space Grotesk', sans-serif; }

/* â”€â”€ SIDEBAR â”€â”€ */
.layout { display: flex; min-height: 100vh; }
.sidebar {
  width: 240px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  transition: transform 0.3s;
}
.sidebar-logo {
  padding: 24px 20px 16px;
  border-bottom: 1px solid var(--border);
}
.sidebar-logo h2 {
  font-size: 1.2rem;
  color: var(--accent);
  display: flex;
  align-items: center;
  gap: 8px;
}
.sidebar-logo span {
  font-size: 0.7rem;
  color: var(--text3);
  font-weight: 400;
  display: block;
  margin-top: 2px;
  padding-left: 28px;
}
.nav-section {
  padding: 12px 12px 6px;
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text3);
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 16px;
  margin: 2px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 0.88rem;
  font-weight: 500;
  color: var(--text2);
  transition: all 0.15s;
  border: none;
  background: none;
  width: calc(100% - 16px);
  text-align: left;
}
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item.active { background: var(--accent-light); color: var(--accent); }
.nav-item i { width: 16px; text-align: center; font-size: 0.85rem; }
.nav-badge {
  margin-left: auto;
  background: var(--accent);
  color: white;
  font-size: 0.65rem;
  padding: 1px 7px;
  border-radius: 20px;
  font-weight: 700;
}
.sidebar-bottom {
  margin-top: auto;
  padding: 16px;
  border-top: 1px solid var(--border);
}
.theme-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.82rem;
  color: var(--text2);
  cursor: pointer;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  background: none;
  border: none;
  width: 100%;
}
.theme-toggle:hover { background: var(--surface2); }

/* â”€â”€ MAIN â”€â”€ */
.main {
  margin-left: 240px;
  flex: 1;
  padding: 24px 28px;
  max-width: calc(100% - 240px);
}
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  gap: 16px;
  flex-wrap: wrap;
}
.page-title {
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--text);
}
.topbar-actions {
  display: flex;
  align-items: center;
  gap: 10px;
}
.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-pill);
  padding: 8px 16px;
  font-size: 0.88rem;
  min-width: 220px;
}
.search-box input {
  border: none;
  background: none;
  outline: none;
  color: var(--text);
  font-family: inherit;
  font-size: 0.88rem;
  width: 100%;
}
.search-box i { color: var(--text3); }
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 9px 18px;
  border-radius: var(--radius-pill);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid transparent;
  transition: all 0.15s;
  font-family: 'DM Sans', sans-serif;
}
.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { background: #1d4ed8; }
.btn-ghost { background: var(--surface); color: var(--text2); border-color: var(--border); }
.btn-ghost:hover { background: var(--surface2); color: var(--text); }
.btn-danger { background: var(--red-light); color: var(--red); border-color: transparent; }
.btn-danger:hover { background: var(--red); color: white; }

/* â”€â”€ STAT CARDS â”€â”€ */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}
.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}
.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: var(--accent);
}
.stat-card.green::before { background: var(--green); }
.stat-card.yellow::before { background: var(--yellow); }
.stat-card.purple::before { background: var(--purple); }
.stat-label {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text3);
  margin-bottom: 8px;
}
.stat-value {
  font-size: 2rem;
  font-weight: 700;
  font-family: 'Space Grotesk', sans-serif;
  color: var(--text);
  line-height: 1;
}
.stat-sub {
  font-size: 0.75rem;
  color: var(--text3);
  margin-top: 6px;
}
.stat-icon {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 2rem;
  opacity: 0.07;
}

/* â”€â”€ FILTERS â”€â”€ */
.filters-bar {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.filter-chip {
  padding: 6px 14px;
  border-radius: var(--radius-pill);
  font-size: 0.8rem;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text2);
  transition: all 0.15s;
}
.filter-chip:hover, .filter-chip.active {
  background: var(--accent-light);
  border-color: var(--accent);
  color: var(--accent);
}
.filter-chip.priority-high { border-color: var(--red); color: var(--red); background: var(--red-light); }
.filter-chip.priority-medium { border-color: var(--yellow); color: var(--yellow); background: var(--yellow-light); }
.filter-chip.priority-low { border-color: var(--green); color: var(--green); background: var(--green-light); }
.filter-chip.priority-high.active { background: var(--red); color: white; }
.filter-chip.priority-medium.active { background: var(--yellow); color: white; }
.filter-chip.priority-low.active { background: var(--green); color: white; }
select.filter-select {
  padding: 6px 14px;
  border-radius: var(--radius-pill);
  font-size: 0.8rem;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text2);
  outline: none;
  font-family: 'DM Sans', sans-serif;
}

/* â”€â”€ PROJECT GRID â”€â”€ */
.project-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  gap: 20px;
}
.project-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow 0.2s, transform 0.2s;
  display: flex;
  flex-direction: column;
}
.project-card:hover { box-shadow: var(--shadow); transform: translateY(-1px); }
.card-top {
  padding: 18px 18px 12px;
  border-bottom: 1px solid var(--border);
}
.card-title-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 10px;
}
.card-title {
  font-family: 'Space Grotesk', sans-serif;
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--text);
}
.card-actions { display: flex; gap: 4px; }
.icon-btn {
  width: 30px; height: 30px;
  border-radius: 8px;
  border: none;
  background: none;
  cursor: pointer;
  color: var(--text3);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.8rem;
  transition: all 0.15s;
}
.icon-btn:hover { background: var(--surface2); color: var(--text); }
.icon-btn.danger:hover { background: var(--red-light); color: var(--red); }

/* priority badge */
.priority-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 10px;
  border-radius: var(--radius-pill);
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}
.priority-high { background: var(--red-light); color: var(--red); }
.priority-medium { background: var(--yellow-light); color: var(--yellow); }
.priority-low { background: var(--green-light); color: var(--green); }

/* meta row */
.card-meta {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}
.meta-item {
  font-size: 0.75rem;
  color: var(--text3);
  display: flex;
  align-items: center;
  gap: 4px;
}
.meta-item.overdue { color: var(--red); }

/* progress */
.progress-section { padding: 14px 18px; border-bottom: 1px solid var(--border); }
.progress-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}
.progress-label { font-size: 0.75rem; color: var(--text2); font-weight: 500; }
.progress-pct { font-size: 0.75rem; font-weight: 700; color: var(--text); }
.progress-bar {
  height: 6px;
  background: var(--surface2);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.4s ease;
}
.progress-fill.annotated { background: var(--accent); }
.progress-fill.reviewed { background: var(--green); }
.progress-mini-stats {
  display: flex;
  gap: 12px;
}
.mini-stat {
  font-size: 0.72rem;
  color: var(--text3);
}
.mini-stat strong { color: var(--text); }

/* assignees section */
.assignee-section {
  padding: 12px 18px;
  border-bottom: 1px solid var(--border);
}
.section-header {
  font-size: 0.72rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text3);
  margin-bottom: 8px;
}
.assignee-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.assignee-select {
  flex: 1;
  min-width: 140px;
  padding: 6px 12px;
  border-radius: var(--radius-pill);
  border: 1px solid var(--border);
  background: var(--surface2);
  color: var(--text);
  font-size: 0.8rem;
  outline: none;
  font-family: 'DM Sans', sans-serif;
}
.assignee-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 8px;
}
.assignee-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: var(--accent-light);
  border: 1px solid var(--accent);
  color: var(--accent);
  padding: 2px 8px;
  border-radius: var(--radius-pill);
  font-size: 0.75rem;
  font-weight: 500;
}
.assignee-tag .remove-btn {
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  padding: 0;
  display: flex;
  align-items: center;
  font-size: 0.65rem;
  opacity: 0.7;
}
.assignee-tag .remove-btn:hover { opacity: 1; }

/* notes section */
.notes-section {
  padding: 12px 18px;
}
.notes-toggle {
  background: none;
  border: none;
  color: var(--text3);
  font-size: 0.78rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  font-family: 'DM Sans', sans-serif;
}
.notes-toggle:hover { color: var(--text); }
.notes-input {
  width: 100%;
  margin-top: 8px;
  padding: 10px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--surface2);
  color: var(--text);
  font-size: 0.82rem;
  font-family: 'DM Sans', sans-serif;
  resize: vertical;
  min-height: 70px;
  outline: none;
}
.notes-input:focus { border-color: var(--accent); }

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 200;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--surface);
  border-radius: 20px;
  padding: 28px;
  width: 560px;
  max-width: 95vw;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  transform: translateY(20px);
  transition: transform 0.2s;
  max-height: 90vh;
  overflow-y: auto;
}
.modal-overlay.open .modal { transform: translateY(0); }
.modal-title {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  margin-bottom: 16px;
}
.form-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.form-field.full { grid-column: 1 / -1; }
.form-field label {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  color: var(--text3);
}
.form-field input, .form-field select, .form-field textarea {
  padding: 9px 14px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--surface2);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.88rem;
  outline: none;
  transition: border-color 0.15s;
}
.form-field input:focus, .form-field select:focus, .form-field textarea:focus {
  border-color: var(--accent);
}
.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

/* â”€â”€ EMPLOYEE PANEL (view) â”€â”€ */
.emp-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 24px;
  box-shadow: var(--shadow-sm);
}
.emp-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 14px;
}
.emp-chip {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 12px;
  border-radius: var(--radius-pill);
  font-size: 0.78rem;
  font-weight: 500;
  cursor: default;
  border: 1px solid var(--border);
  color: var(--text2);
  background: var(--surface2);
  transition: all 0.15s;
}
.emp-chip.assigned { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
.emp-chip.conflict { background: var(--red-light); border-color: var(--red); color: var(--red); }
.emp-search {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}
.emp-search input {
  flex: 1;
  padding: 8px 14px;
  border-radius: var(--radius-pill);
  border: 1px solid var(--border);
  background: var(--surface2);
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem;
  outline: none;
}
.emp-search input:focus { border-color: var(--accent); }
.conflict-banner {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: var(--red-light);
  border: 1px solid var(--red);
  border-radius: var(--radius-sm);
  color: var(--red);
  font-size: 0.82rem;
  font-weight: 600;
  margin-bottom: 16px;
}

/* â”€â”€ WORKLOAD VIEW â”€â”€ */
.workload-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  margin-bottom: 20px;
}
.workload-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
  gap: 12px;
  flex-wrap: wrap;
}
.workload-row:last-child { border-bottom: none; }
.workload-emp { font-weight: 600; font-size: 0.9rem; min-width: 120px; }
.workload-projects { color: var(--text3); font-size: 0.8rem; flex: 1; }
.workload-bar-wrap { width: 180px; }

/* â”€â”€ EXPORT BTN â”€â”€ */
.export-btn { background: var(--green-light); color: var(--green); border-color: var(--green); }
.export-btn:hover { background: var(--green); color: white; }

/* â”€â”€ PAGES â”€â”€ */
.page { display: none; }
.page.active { display: block; }

/* â”€â”€ TAGS â”€â”€ */
.tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
}

/* â”€â”€ TOAST â”€â”€ */
.toast-container {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 999;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.toast {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 18px;
  font-size: 0.85rem;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 8px;
  animation: slideIn 0.2s ease;
  max-width: 320px;
}
.toast.success { border-color: var(--green); color: var(--green); }
.toast.error { border-color: var(--red); color: var(--red); }
.toast.info { border-color: var(--accent); color: var(--accent); }
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text3);
}
.empty-state i { font-size: 3rem; margin-bottom: 12px; display: block; }
.empty-state h3 { font-size: 1rem; color: var(--text2); margin-bottom: 6px; }

/* stats inline */
.inline-stats {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  align-items: center;
  margin-top: 10px;
}
.inline-stat {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 0.78rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 70px;
}
.inline-stat .v { font-weight: 700; font-size: 1rem; color: var(--text); }
.inline-stat .l { color: var(--text3); font-size: 0.65rem; }

/* edit inputs inline */
.edit-input {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 4px 8px;
  font-size: 0.82rem;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  outline: none;
  width: 80px;
  text-align: right;
}
.edit-input:focus { border-color: var(--accent); }

/* responsive */
@media(max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; max-width: 100%; padding: 16px; }
}
</style>
</head>
<body>
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <h2><i class="fas fa-layer-group"></i> AnnotateHQ</h2>
      <span>Data Annotation Platform</span>
    </div>
    <div class="nav-section">Main</div>
    <button class="nav-item active" data-page="dashboard" onclick="switchPage('dashboard')">
      <i class="fas fa-th-large"></i> Dashboard
    </button>
    <button class="nav-item" data-page="projects" onclick="switchPage('projects')">
      <i class="fas fa-folder-open"></i> Projects
      <span class="nav-badge" id="nav-proj-count">4</span>
    </button>
    <button class="nav-item" data-page="employees" onclick="switchPage('employees')">
      <i class="fas fa-users"></i> Employees
    </button>
    <button class="nav-item" data-page="workload" onclick="switchPage('workload')">
      <i class="fas fa-chart-bar"></i> Workload
    </button>
    <div class="nav-section">Actions</div>
    <button class="nav-item" onclick="openAddModal()">
      <i class="fas fa-plus-circle"></i> New Project
    </button>
    <button class="nav-item" onclick="exportCSV()">
      <i class="fas fa-download"></i> Export CSV
    </button>
    <div class="sidebar-bottom">
      <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon" id="themeIcon"></i>
        <span id="themeLabel">Dark mode</span>
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- â”€â”€ PAGE: DASHBOARD â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="topbar">
        <h1 class="page-title">Dashboard</h1>
        <div class="topbar-actions">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search projects..." id="globalSearch" oninput="handleSearch()">
          </div>
          <button class="btn btn-primary" onclick="openAddModal()"><i class="fas fa-plus"></i> New project</button>
        </div>
      </div>

      <!-- Stats -->
      <div class="stat-grid" id="statGrid"></div>

      <!-- Conflict banner -->
      <div class="conflict-banner" id="conflictBanner" style="display:none;">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="conflictBannerText">Double-booking detected!</span>
        <button class="btn btn-ghost" style="margin-left:auto; padding:4px 12px; font-size:0.75rem;" onclick="switchPage('employees')">View Employees â†’</button>
      </div>

      <!-- Filters -->
      <div class="filters-bar">
        <span style="font-size:0.78rem; color:var(--text3); font-weight:600;">FILTER:</span>
        <button class="filter-chip active" onclick="setFilter('all', this)">All</button>
        <button class="filter-chip priority-high" onclick="setFilter('high', this)"><i class="fas fa-fire"></i> High</button>
        <button class="filter-chip priority-medium" onclick="setFilter('medium', this)"><i class="fas fa-minus"></i> Medium</button>
        <button class="filter-chip priority-low" onclick="setFilter('low', this)"><i class="fas fa-leaf"></i> Low</button>
        <select class="filter-select" id="sortSelect" onchange="renderProjects()">
          <option value="default">Sort: Default</option>
          <option value="name">Sort: Name</option>
          <option value="progress">Sort: Progress</option>
          <option value="deadline">Sort: Deadline</option>
          <option value="priority">Sort: Priority</option>
        </select>
      </div>

      <!-- Project grid -->
      <div class="project-grid" id="projectGrid"></div>
    </div>

    <!-- â”€â”€ PAGE: PROJECTS (full list) â”€â”€ -->
    <div class="page" id="page-projects">
      <div class="topbar">
        <h1 class="page-title">All Projects</h1>
        <div class="topbar-actions">
          <button class="btn export-btn" onclick="exportCSV()"><i class="fas fa-file-csv"></i> Export CSV</button>
          <button class="btn btn-primary" onclick="openAddModal()"><i class="fas fa-plus"></i> New project</button>
        </div>
      </div>
      <div class="project-grid" id="projectGridFull"></div>
    </div>

    <!-- â”€â”€ PAGE: EMPLOYEES â”€â”€ -->
    <div class="page" id="page-employees">
      <div class="topbar">
        <h1 class="page-title">Employees <span id="empTotalSpan" style="font-size:1rem; color:var(--text3); font-weight:400;"></span></h1>
      </div>
      <div id="conflictBannerEmp" style="display:none;" class="conflict-banner">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="conflictBannerEmpText"></span>
      </div>
      <div class="emp-search">
        <i class="fas fa-search" style="color:var(--text3)"></i>
        <input type="text" placeholder="Search employee name..." id="empSearch" oninput="renderEmployees()">
      </div>
      <div class="emp-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <b style="font-size:0.9rem;">Employee Status</b>
          <div style="display:flex;gap:12px; font-size:0.75rem; color:var(--text3);">
            <span><span style="background:var(--surface2);border:1px solid var(--border); padding:2px 8px; border-radius:6px;">â¬œ</span> Free</span>
            <span><span style="background:var(--accent-light);border:1px solid var(--accent); color:var(--accent); padding:2px 8px; border-radius:6px;">âœ“</span> Assigned</span>
            <span><span style="background:var(--red-light);border:1px solid var(--red); color:var(--red); padding:2px 8px; border-radius:6px;">âš </span> Conflict</span>
          </div>
        </div>
        <div class="emp-grid" id="empGrid"></div>
      </div>
    </div>

    <!-- â”€â”€ PAGE: WORKLOAD â”€â”€ -->
    <div class="page" id="page-workload">
      <div class="topbar">
        <h1 class="page-title">Workload Overview</h1>
      </div>
      <div class="workload-card">
        <div style="font-size:0.85rem; color:var(--text2); margin-bottom:16px;">Only employees with at least one assignment are shown.</div>
        <div id="workloadList"></div>
      </div>
    </div>

  </main>
</div>

<!-- MODAL: Add/Edit Project -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModalIfBg(event)">
  <div class="modal">
    <div class="modal-title"><i class="fas fa-plus-circle" style="color:var(--accent)"></i> <span id="modalTitleText">New Project</span></div>
    <div class="form-grid">
      <div class="form-field full">
        <label>Project name *</label>
        <input type="text" id="f-name" placeholder="e.g. Satellite buildings" required>
      </div>
      <div class="form-field">
        <label>Total images</label>
        <input type="number" id="f-total" value="1000" min="0">
      </div>
      <div class="form-field">
        <label>Annotated</label>
        <input type="number" id="f-annotated" value="0" min="0">
      </div>
      <div class="form-field">
        <label>Reviewed</label>
        <input type="number" id="f-reviewed" value="0" min="0">
      </div>
      <div class="form-field">
        <label>Priority</label>
        <select id="f-priority">
          <option value="medium">âš¡ Medium</option>
          <option value="high">ðŸ”¥ High</option>
          <option value="low">ðŸŒ¿ Low</option>
        </select>
      </div>
      <div class="form-field">
        <label>Deadline</label>
        <input type="date" id="f-deadline">
      </div>
      <div class="form-field full">
        <label>Notes</label>
        <textarea id="f-notes" placeholder="Any notes about this project..." style="resize:vertical; min-height:60px;"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveProject()"><i class="fas fa-save"></i> Save project</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const EMPLOYEES = Array.from({length: 68}, (_, i) => ({
  id: `emp_${i+1}`,
  name: `Employee ${i+1}`
}));

let projects = [
  { id:'p1', name:'Satellite Buildings', total:1240, annotated:846, reviewed:612, priority:'high', deadline:'2025-08-15', assignedEmployees:['emp_1','emp_2','emp_5'], notes:'Focus on residential areas first.' },
  { id:'p2', name:'MRI Tumor Masks', total:860, annotated:420, reviewed:210, priority:'high', deadline:'2025-09-01', assignedEmployees:['emp_3','emp_4'], notes:'' },
  { id:'p3', name:'Street Scene Objects', total:2350, annotated:1800, reviewed:920, priority:'medium', deadline:'2025-10-20', assignedEmployees:['emp_6','emp_7'], notes:'YOLO format required.' },
  { id:'p4', name:'Road Markings', total:430, annotated:305, reviewed:200, priority:'low', deadline:'2025-07-30', assignedEmployees:['emp_8','emp_9','emp_10'], notes:'' },
  { id:'p5', name:'Aerial Tree Detection', total:780, annotated:120, reviewed:40, priority:'medium', deadline:'2025-11-01', assignedEmployees:['emp_11'], notes:'' },
];

let currentFilter = 'all';
let currentSearchQuery = '';
let editingProjectId = null;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genId() { return 'p_' + Date.now().toString(36); }

function getAssignmentMap() {
  const m = new Map();
  projects.forEach(p => (p.assignedEmployees||[]).forEach(e => m.set(e,(m.get(e)||0)+1)));
  return m;
}

function isAvailable(empId, excludeProjectId=null) {
  return !projects.some(p => p.id !== excludeProjectId && (p.assignedEmployees||[]).includes(empId));
}

function getConflicts() {
  const m = getAssignmentMap();
  return [...m.entries()].filter(([,c]) => c > 1).map(([id]) => id);
}

function pct(a,b) { return b > 0 ? Math.round((a/b)*100) : 0; }

function fmtDeadline(d) {
  if (!d) return null;
  const date = new Date(d+'T00:00:00');
  const now = new Date();
  const diff = Math.ceil((date - now) / 86400000);
  return { label: date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}), diff };
}

function escHtml(s) {
  return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function toast(msg, type='info') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<i class="fas ${type==='success'?'fa-check-circle':type==='error'?'fa-times-circle':'fa-info-circle'}"></i> ${msg}`;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PAGES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
  if (page === 'employees') renderEmployees();
  if (page === 'workload') renderWorkload();
  if (page === 'projects') renderProjectsFull();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER STATS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats() {
  const totalImages = projects.reduce((s,p) => s+(+p.total||0), 0);
  const totalAnnotated = projects.reduce((s,p) => s+(+p.annotated||0), 0);
  const totalReviewed = projects.reduce((s,p) => s+(+p.reviewed||0), 0);
  const assignedEmps = new Set(projects.flatMap(p => p.assignedEmployees||[])).size;
  const conflicts = getConflicts().length;

  const cards = [
    { label:'Total Projects', value: projects.length, sub: `${projects.filter(p=>p.priority==='high').length} high priority`, color:'', icon:'fa-folder-open' },
    { label:'Total Images', value: totalImages.toLocaleString(), sub: `${pct(totalAnnotated,totalImages)}% annotated`, color:'', icon:'fa-images' },
    { label:'Annotated', value: totalAnnotated.toLocaleString(), sub: `${pct(totalAnnotated,totalImages)}% complete`, color:'green', icon:'fa-check-circle' },
    { label:'Reviewed', value: totalReviewed.toLocaleString(), sub: `${pct(totalReviewed,totalImages)}% complete`, color:'yellow', icon:'fa-eye' },
    { label:'Employees Assigned', value: assignedEmps, sub: `${68-assignedEmps} free`, color:'purple', icon:'fa-users' },
    { label:'Conflicts', value: conflicts, sub: conflicts > 0 ? 'double-booked!' : 'none detected', color:'', icon:'fa-exclamation-triangle' },
  ];

  document.getElementById('statGrid').innerHTML = cards.map(c => `
    <div class="stat-card ${c.color}">
      <div class="stat-label">${c.label}</div>
      <div class="stat-value">${c.value}</div>
      <div class="stat-sub">${c.sub}</div>
      <i class="fas ${c.icon} stat-icon"></i>
    </div>
  `).join('');

  document.getElementById('nav-proj-count').textContent = projects.length;

  const conflictsList = getConflicts();
  const cb = document.getElementById('conflictBanner');
  if (conflictsList.length > 0) {
    cb.style.display = 'flex';
    document.getElementById('conflictBannerText').textContent = `âš  ${conflictsList.length} employee(s) double-booked: ${conflictsList.map(id => EMPLOYEES.find(e=>e.id===id)?.name||id).join(', ')}`;
  } else {
    cb.style.display = 'none';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER PROJECTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getFilteredProjects() {
  const sort = document.getElementById('sortSelect')?.value || 'default';
  let list = [...projects];

  if (currentFilter !== 'all') list = list.filter(p => p.priority === currentFilter);
  if (currentSearchQuery) {
    const q = currentSearchQuery.toLowerCase();
    list = list.filter(p => p.name.toLowerCase().includes(q) ||
      (p.notes||'').toLowerCase().includes(q) ||
      (p.assignedEmployees||[]).some(id => EMPLOYEES.find(e=>e.id===id)?.name.toLowerCase().includes(q))
    );
  }

  if (sort === 'name') list.sort((a,b) => a.name.localeCompare(b.name));
  else if (sort === 'progress') list.sort((a,b) => pct(b.annotated,b.total) - pct(a.annotated,a.total));
  else if (sort === 'deadline') list.sort((a,b) => (a.deadline||'9999').localeCompare(b.deadline||'9999'));
  else if (sort === 'priority') {
    const w = {high:0,medium:1,low:2};
    list.sort((a,b) => (w[a.priority]||1) - (w[b.priority]||1));
  }
  return list;
}

function buildProjectCard(proj, aMap) {
  const total = +proj.total||0, annotated = +proj.annotated||0, reviewed = +proj.reviewed||0;
  const annPct = pct(annotated, total);
  const revPct = pct(reviewed, total);
  const pendAnnot = Math.max(total-annotated, 0);
  const pendRev = Math.max(annotated-reviewed, 0);
  const assigned = proj.assignedEmployees||[];
  const dl = fmtDeadline(proj.deadline);
  const isOverdue = dl && dl.diff < 0;
  const isDueSoon = dl && dl.diff >= 0 && dl.diff <= 7;

  const availableEmps = EMPLOYEES.filter(e => !assigned.includes(e.id) && isAvailable(e.id, proj.id));

  const priorityLabel = {high:'ðŸ”¥ High', medium:'âš¡ Medium', low:'ðŸŒ¿ Low'}[proj.priority]||'Medium';

  return `
  <div class="project-card" id="card-${proj.id}">
    <div class="card-top">
      <div class="card-title-row">
        <span class="card-title">${escHtml(proj.name)}</span>
        <div class="card-actions">
          <button class="icon-btn" onclick="openEditModal('${proj.id}')" title="Edit"><i class="fas fa-pen"></i></button>
          <button class="icon-btn danger" onclick="deleteProject('${proj.id}')" title="Delete"><i class="fas fa-trash"></i></button>
        </div>
      </div>
      <div class="card-meta">
        <span class="priority-badge priority-${proj.priority}">${priorityLabel}</span>
        ${dl ? `<span class="meta-item ${isOverdue?'overdue':''}"><i class="fas fa-calendar-alt"></i> ${dl.label} ${isOverdue?'(Overdue)':isDueSoon?`(${dl.diff}d left)`:''}` +'</span>' : ''}
      </div>
      <!-- Inline editable stats -->
      <div class="inline-stats">
        <div class="inline-stat">
          <input class="edit-input" type="number" value="${total}" data-id="${proj.id}" data-field="total" onchange="updateField('${proj.id}','total',this.value)">
          <span class="l">Total</span>
        </div>
        <div class="inline-stat">
          <input class="edit-input" type="number" value="${annotated}" data-id="${proj.id}" data-field="annotated" onchange="updateField('${proj.id}','annotated',this.value)">
          <span class="l">Annotated</span>
        </div>
        <div class="inline-stat">
          <input class="edit-input" type="number" value="${reviewed}" data-id="${proj.id}" data-field="reviewed" onchange="updateField('${proj.id}','reviewed',this.value)">
          <span class="l">Reviewed</span>
        </div>
        <div class="inline-stat">
          <span class="v" style="color:var(--yellow)">${pendAnnot}</span>
          <span class="l">Pending Ann.</span>
        </div>
        <div class="inline-stat">
          <span class="v" style="color:var(--purple)">${pendRev}</span>
          <span class="l">Pending Rev.</span>
        </div>
      </div>
    </div>
    <div class="progress-section">
      <div class="progress-row"><span class="progress-label">Annotation progress</span><span class="progress-pct">${annPct}%</span></div>
      <div class="progress-bar"><div class="progress-fill annotated" style="width:${annPct}%"></div></div>
      <div class="progress-row"><span class="progress-label">Review progress</span><span class="progress-pct">${revPct}%</span></div>
      <div class="progress-bar"><div class="progress-fill reviewed" style="width:${revPct}%"></div></div>
    </div>
    <div class="assignee-section">
      <div class="section-header">Assigned employees (${assigned.length})</div>
      <div class="assignee-row">
        <select class="assignee-select" id="sel-${proj.id}" ${availableEmps.length===0?'disabled':''}>
          <option value="">-- assign employee --</option>
          ${availableEmps.map(e => `<option value="${e.id}">${e.name}</option>`).join('')}
        </select>
        <button class="btn btn-primary" style="padding:6px 14px; font-size:0.78rem;" onclick="assignEmployee('${proj.id}')"><i class="fas fa-plus"></i></button>
      </div>
      <div class="assignee-tags" id="atags-${proj.id}">
        ${assigned.length===0 ? '<span style="color:var(--text3); font-size:0.78rem;">No employees assigned</span>' :
          assigned.map(id => {
            const emp = EMPLOYEES.find(e=>e.id===id)||{name:'Unknown'};
            const conflict = (aMap.get(id)||0) > 1;
            return `<span class="assignee-tag ${conflict?'style="background:var(--red-light);border-color:var(--red);color:var(--red);"':''}">
              ${conflict?'âš  ':''}${emp.name}
              <button class="remove-btn" onclick="removeEmployee('${proj.id}','${id}')"><i class="fas fa-times"></i></button>
            </span>`;
          }).join('')
        }
      </div>
    </div>
    ${proj.notes ? `<div class="notes-section"><div class="section-header"><i class="fas fa-sticky-note"></i> Notes</div><div style="font-size:0.82rem; color:var(--text2);">${escHtml(proj.notes)}</div></div>` : ''}
  </div>`;
}

function renderProjects() {
  const list = getFilteredProjects();
  const aMap = getAssignmentMap();
  const grid = document.getElementById('projectGrid');
  if (list.length === 0) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;"><i class="fas fa-folder-open"></i><h3>No projects found</h3><p>Try adjusting your filters or add a new project.</p></div>`;
  } else {
    grid.innerHTML = list.map(p => buildProjectCard(p, aMap)).join('');
  }
  renderStats();
}

function renderProjectsFull() {
  const aMap = getAssignmentMap();
  const grid = document.getElementById('projectGridFull');
  grid.innerHTML = projects.map(p => buildProjectCard(p, aMap)).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FIELD EDITING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateField(id, field, val) {
  const p = projects.find(x => x.id === id);
  if (!p) return;
  p[field] = Math.max(0, parseInt(val)||0);
  renderProjects();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMPLOYEE ASSIGNMENT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function assignEmployee(projId) {
  const sel = document.getElementById(`sel-${projId}`);
  const empId = sel?.value;
  if (!empId) { toast('Please select an employee', 'error'); return; }
  const proj = projects.find(p => p.id === projId);
  if (!proj) return;
  if (!isAvailable(empId, projId)) { toast('Employee already assigned elsewhere!', 'error'); return; }
  if (!proj.assignedEmployees) proj.assignedEmployees = [];
  proj.assignedEmployees.push(empId);
  toast(`${EMPLOYEES.find(e=>e.id===empId)?.name} assigned âœ“`, 'success');
  renderProjects();
}

function removeEmployee(projId, empId) {
  const proj = projects.find(p => p.id === projId);
  if (!proj) return;
  proj.assignedEmployees = (proj.assignedEmployees||[]).filter(e => e !== empId);
  toast(`Employee unassigned`, 'info');
  renderProjects();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DELETE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function deleteProject(id) {
  if (!confirm('Delete this project?')) return;
  projects = projects.filter(p => p.id !== id);
  toast('Project deleted', 'info');
  renderProjects();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddModal() {
  editingProjectId = null;
  document.getElementById('modalTitleText').textContent = 'New Project';
  document.getElementById('f-name').value = '';
  document.getElementById('f-total').value = '1000';
  document.getElementById('f-annotated').value = '0';
  document.getElementById('f-reviewed').value = '0';
  document.getElementById('f-priority').value = 'medium';
  document.getElementById('f-deadline').value = '';
  document.getElementById('f-notes').value = '';
  document.getElementById('modalOverlay').classList.add('open');
}

function openEditModal(id) {
  const p = projects.find(x => x.id === id);
  if (!p) return;
  editingProjectId = id;
  document.getElementById('modalTitleText').textContent = 'Edit Project';
  document.getElementById('f-name').value = p.name;
  document.getElementById('f-total').value = p.total;
  document.getElementById('f-annotated').value = p.annotated;
  document.getElementById('f-reviewed').value = p.reviewed;
  document.getElementById('f-priority').value = p.priority||'medium';
  document.getElementById('f-deadline').value = p.deadline||'';
  document.getElementById('f-notes').value = p.notes||'';
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('open');
}

function closeModalIfBg(e) {
  if (e.target === document.getElementById('modalOverlay')) closeModal();
}

function saveProject() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { toast('Project name is required', 'error'); return; }
  const data = {
    name,
    total: parseInt(document.getElementById('f-total').value)||0,
    annotated: parseInt(document.getElementById('f-annotated').value)||0,
    reviewed: parseInt(document.getElementById('f-reviewed').value)||0,
    priority: document.getElementById('f-priority').value,
    deadline: document.getElementById('f-deadline').value,
    notes: document.getElementById('f-notes').value.trim(),
  };

  if (editingProjectId) {
    const idx = projects.findIndex(p => p.id === editingProjectId);
    if (idx > -1) { Object.assign(projects[idx], data); toast('Project updated âœ“', 'success'); }
  } else {
    projects.push({ id: genId(), assignedEmployees: [], ...data });
    toast('Project created âœ“', 'success');
  }

  closeModal();
  renderProjects();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FILTERS & SEARCH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setFilter(val, el) {
  currentFilter = val;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  renderProjects();
}

function handleSearch() {
  currentSearchQuery = document.getElementById('globalSearch').value;
  renderProjects();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EMPLOYEES PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderEmployees() {
  const aMap = getAssignmentMap();
  const conflicts = getConflicts();
  const query = (document.getElementById('empSearch')?.value||'').toLowerCase();

  const banner = document.getElementById('conflictBannerEmp');
  if (conflicts.length > 0) {
    banner.style.display = 'flex';
    document.getElementById('conflictBannerEmpText').textContent =
      `âš  Double-booking detected: ${conflicts.map(id=>EMPLOYEES.find(e=>e.id===id)?.name||id).join(', ')}`;
  } else {
    banner.style.display = 'none';
  }

  const filtered = query ? EMPLOYEES.filter(e => e.name.toLowerCase().includes(query)) : EMPLOYEES;
  const assigned = filtered.filter(e => (aMap.get(e.id)||0) > 0).length;
  document.getElementById('empTotalSpan').textContent = `(${assigned} assigned, ${filtered.length - assigned} free)`;

  document.getElementById('empGrid').innerHTML = filtered.map(emp => {
    const cnt = aMap.get(emp.id)||0;
    const cls = cnt > 1 ? 'conflict' : cnt === 1 ? 'assigned' : '';
    const icon = cnt > 1 ? 'âš ' : cnt === 1 ? 'âœ“' : 'Â·';
    const projs = cnt > 0 ? projects.filter(p=>(p.assignedEmployees||[]).includes(emp.id)).map(p=>p.name).join(', ') : '';
    return `<span class="emp-chip ${cls}" title="${projs||'Not assigned'}">${icon} ${emp.name}</span>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WORKLOAD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWorkload() {
  const aMap = getAssignmentMap();
  const assigned = [...aMap.entries()].filter(([,c]) => c > 0).sort((a,b) => b[1]-a[1]);

  if (assigned.length === 0) {
    document.getElementById('workloadList').innerHTML = '<div class="empty-state"><i class="fas fa-chart-bar"></i><h3>No employees assigned yet.</h3></div>';
    return;
  }

  const maxProjs = Math.max(...assigned.map(([,c]) => c));

  document.getElementById('workloadList').innerHTML = assigned.map(([empId, cnt]) => {
    const emp = EMPLOYEES.find(e => e.id === empId);
    const projs = projects.filter(p => (p.assignedEmployees||[]).includes(empId));
    const pct = Math.round((cnt/maxProjs)*100);
    const isConflict = cnt > 1;
    return `<div class="workload-row">
      <span class="workload-emp">${emp?.name||empId}</span>
      <span class="workload-projects">${projs.map(p=>p.name).join(' Â· ')}</span>
      <div class="workload-bar-wrap">
        <div class="progress-bar" style="height:8px;">
          <div class="progress-fill ${isConflict?'':'annotated'}" style="width:${pct}%; ${isConflict?'background:var(--red)':''}"></div>
        </div>
        <div style="font-size:0.72rem; color:${isConflict?'var(--red)':'var(--text3)'}; margin-top:2px; text-align:right;">
          ${cnt} project${cnt>1?'s':''} ${isConflict?'âš  CONFLICT':''}
        </div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// EXPORT CSV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportCSV() {
  const headers = ['Project Name','Priority','Total Images','Annotated','Reviewed','Pending Annotation','Pending Review','% Annotated','Deadline','Assigned Employees','Notes'];
  const rows = projects.map(p => {
    const t=+p.total||0, a=+p.annotated||0, r=+p.reviewed||0;
    const emps = (p.assignedEmployees||[]).map(id=>EMPLOYEES.find(e=>e.id===id)?.name||id).join('; ');
    return [
      `"${p.name}"`,
      p.priority,
      t, a, r,
      Math.max(t-a,0),
      Math.max(a-r,0),
      pct(a,t)+'%',
      p.deadline||'',
      `"${emps}"`,
      `"${(p.notes||'').replace(/"/g,'""')}"`
    ].join(',');
  });
  const csv = [headers.join(','), ...rows].join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='annotation_projects.csv'; a.click();
  URL.revokeObjectURL(url);
  toast('CSV exported âœ“', 'success');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// THEME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('themeIcon').className = isDark ? 'fas fa-moon' : 'fas fa-sun';
  document.getElementById('themeLabel').textContent = isDark ? 'Dark mode' : 'Light mode';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderProjects();
</script>
</body>
</html>
